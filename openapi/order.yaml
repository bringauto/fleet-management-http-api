paths:
  /order:
    post:
      operationId: createOrder
      x-openapi-router-controller: fleet_management_api.api_impl.controllers.order
      tags:
        - order
      summary: Create a new order
      requestBody:
        description: New order json
        x-body-name: order
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Order'
        required: true
      responses:
        '200':
          description: Successful order creation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          $ref: 'errors.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'errors.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'errors.yaml#/components/responses/Forbidden'
        default:
          $ref: 'errors.yaml#/components/responses/UnexpectedError'
    get:
      operationId: getOrders
      x-openapi-router-controller: fleet_management_api.api_impl.controllers.order
      tags:
        - order
      summary: Finds all orders
      responses:
        '200':
          description: Successfuly found all orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
              example:
                [
                  {
                    "id": 1,
                    "priority": "normal",
                    "userId": 1,
                    "status": "to_accept",
                    "carId": 1,
                    "targetStopId": 1,
                    "stopRouteId": 1,
                    "notificationPhone": {"phone":'+420123456789'}
                  }
                ]
        '401':
          $ref: 'errors.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'errors.yaml#/components/responses/Forbidden'
        default:
          $ref: 'errors.yaml#/components/responses/UnexpectedError'
    put:
      operationId: updateOrder
      x-openapi-router-controller: fleet_management_api.api_impl.controllers.order
      tags:
        - order
      summary: Update an existing order by ID
      requestBody:
        description: Order update json
        x-body-name: order
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Order'
        required: true
      responses:
        '200':
          description: Successful order update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          $ref: 'errors.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'errors.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'errors.yaml#/components/responses/Forbidden'
        '404':
          $ref: 'errors.yaml#/components/responses/NotFound'
        default:
          $ref: 'errors.yaml#/components/responses/UnexpectedError'
  /order/{orderId}:
    get:
      operationId: getOrder
      x-openapi-router-controller: fleet_management_api.api_impl.controllers.order
      tags:
        - order
      summary: Finds order by ID
      parameters:
        - name: orderId
          in: path
          description: ID of order to return
          required: true
          example: 1
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Successfuly found order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          $ref: 'errors.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'errors.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'errors.yaml#/components/responses/Forbidden'
        '404':
          $ref: 'errors.yaml#/components/responses/NotFound'
        default:
          $ref: 'errors.yaml#/components/responses/UnexpectedError'
    delete:
      operationId: deleteOrder
      x-openapi-router-controller: fleet_management_api.api_impl.controllers.order
      tags:
        - order
      summary: Delete an order
      parameters:
        - name: orderId
          in: path
          description: ID of order to delete
          required: true
          example: 1
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Successful order removal
        '400':
          $ref: 'errors.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'errors.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'errors.yaml#/components/responses/Forbidden'
        '404':
          $ref: 'errors.yaml#/components/responses/NotFound'
        '405':
          $ref: 'errors.yaml#/components/responses/MethodNotAllowed'
        default:
          $ref: 'errors.yaml#/components/responses/UnexpectedError'
  /order/wait/{carId}:
    get:
      operationId: getUpdatedOrders
      x-openapi-router-controller: fleet_management_api.api_impl.controllers.order
      tags:
        - order
      summary: Get order by car ID only if it changed
      parameters:
        - name: carId
          in: path
          description: ID of car with order to return
          required: true
          example: 1
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Successfuly received new order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          $ref: 'errors.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'errors.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'errors.yaml#/components/responses/Forbidden'
        '404':
          $ref: 'errors.yaml#/components/responses/NotFound'
        '408':
          $ref: 'errors.yaml#/components/responses/RequestTimeout'
        default:
          $ref: 'errors.yaml#/components/responses/UnexpectedError'
  /orderstate:
    post:
      operationId: createOrderState
      x-openapi-router-controller: fleet_management_api.api_impl.controllers.order_state
      tags:
        - orderState
      summary: Create a new order state
      requestBody:
        description: New order state json
        x-body-name: orderState
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderState'
        required: true
      responses:
        '200':
          description: Succesfully added new order state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderState'
        '400':
          $ref: 'errors.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'errors.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'errors.yaml#/components/responses/Forbidden'
        '404':
          $ref: 'errors.yaml#/components/responses/NotFound'
        default:
          $ref: 'errors.yaml#/components/responses/UnexpectedError'
    get:
      operationId: getAllOrderStates
      x-openapi-router-controller: fleet_management_api.api_impl.controllers.order_state
      tags:
        - orderState
      summary: Finds all order states
      responses:
        '200':
          description: Successfuly found all order states
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderState'
              example:
                [
                  {
                    "id": 1,
                    "orderId": 1,
                    "status": "to_accept",
                    "carId": 1
                  }
                ]
        '401':
          $ref: 'errors.yaml#/components/responses/Unauthorized'
        '403':
          $ref: 'errors.yaml#/components/responses/Forbidden'
        default:
          $ref: 'errors.yaml#/components/responses/UnexpectedError'
  /orderstate/{orderId}:
    get:
      operationId: getOrderStates
      x-openapi-router-controller: fleet_management_api.api_impl.controllers.order_state
      tags:
        - orderState
      summary: Finds order state by ID
      parameters:
        - name: orderId
          in: path
          description: ID of order for which states shall be returned
          required: true
          example: 1
          schema:
            type: integer
            format: int32
        - name: allAvailable
          in: query
          description: Whether to return all available order states or only the latest one
          required: false
          example: true
          schema:
            type: boolean
      responses:
        '200':
          description: Successfuly found order state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderState'
        '400':
          $ref: 'errors.yaml#/components/responses/BadRequest'
        '401':
          $ref: 'errors.yaml#/components/responses/Unauthorized'
        '404':
          $ref: 'errors.yaml#/components/responses/NotFound'
        default:
          $ref: 'errors.yaml#/components/responses/UnexpectedError'

components:
  schemas:
    Order:
      type: object
      description: Order object structure
      required:
        - id
        - userId
        - carId
        - targetStopId
        - stopRouteId
      properties:
        id:
          $ref: 'common_models.yaml#/components/schemas/Id'
        priority:
          $ref: "#/components/schemas/Priority"
        userId:
          $ref: 'common_models.yaml#/components/schemas/Id'
        carId:
          $ref: 'common_models.yaml#/components/schemas/Id'
        notification:
          type: string
          example: 'Order notification'
        targetStopId:
          $ref: 'common_models.yaml#/components/schemas/Id'
        stopRouteId:
          $ref: 'common_models.yaml#/components/schemas/Id'
        notificationPhone:
          $ref: 'common_models.yaml#/components/schemas/MobilePhone'
    OrderState:
      type: object
      description: Order state object structure
      required:
        - id
        - status
        - orderId
      properties:
        id:
          $ref: 'common_models.yaml#/components/schemas/Id'
        status:
          $ref: '#/components/schemas/OrderStatus'
        orderId:
          $ref: 'common_models.yaml#/components/schemas/Id'
        timestamp:
          $ref: 'common_models.yaml#/components/schemas/Timestamp'
    OrderStatus:
      type: string
      description: OrderStatus (to_accept, accepted, in_progress, done, canceled)
      enum:
        - to_accept
        - accepted
        - in_progress
        - done
        - canceled
      example: to_accept
    # OpenAPI Generator IGNORES default value when using enum. Using pattern matching instead.
    # The pattern is checked ONLY when the value is passed to the API, not when any of the objects below is created.
    Priority:
      type: string
      description: Priority (low, normal, high)
      pattern: ^(low|normal|high)$
      default: "normal"
